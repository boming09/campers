<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappers.search.SearchMapper">

	<resultMap id="searchAllCampMap"
		type="com.cp.campers.search.model.vo.SearchCamp">
		<id property="cNo" column="CAMP_NO" />
		<result property="cName" column="CAMP_NAME" />
		<result property="cAddress" column="CAMP_ADDRESS" />
		<result property="fileRoute" column="FILE_ROUTE" />
		<result property="fileName" column="FILE_NEW_NAME" />
		<result property="rCount" column="ROOM_COUNT" />
		<result property="maxGuest" column="MAX_GUEST" />
		<result property="minPrice" column="MIN_PRICE" />
		<result property="maxPrice" column="MAX_PRICE" />
	</resultMap>



	<select id="mainSearch" parameterType="hashmap" resultType="com.cp.campers.search.model.vo.SearchCamp">
		SELECT 
				C.CAMP_NO 
			  , C.CAMP_NAME 
			  , C.CAMP_ADDRESS 
			  , F.FILE_ROUTE 
			  , F.FILE_NEW_NAME 
			  , SUM(R.ROOM_COUNT) AS ROOM_COUNT 
			  , MAX(R.ROOM_MEMBER) AS MAX_GUEST 
			  , MIN(R.ROOM_PRICE) AS MIN_PRICE
			  , MAX(R.ROOM_PRICE) AS MAX_PRICE
		   FROM ROOM R 
		   JOIN RESERVE E ON R.ROOM_NO = E.ROOM_NO 
		   JOIN CAMP C ON R.CAMP_NO = C.CAMP_NO 
		   JOIN CAMP_FILE I ON C.CAMP_NO = I.CAMP_NO 
		   JOIN "FILE" F ON I.FILE_NO = F.FILE_NO
		   JOIN CAMP_BUSINESS_TYPE T ON C.CAMP_NO = T.CAMP_NO
		   JOIN BUSINESS_TYPE B ON B.BUSINESS_NO = T.BUSINESS_NO 
		   WHERE C.CAMP_STATUS = 'Y' 
		   AND C.CAMP_ADDRESS LIKE '%' || #{area} || '%' 
		   AND R.ROOM_MEMBER &gt;= #{guest} 
		   AND E.CHECKIN NOT IN #{checkIn} 
		   AND E.CHECKOUT NOT IN #{checkOut} 
		   AND F.FILE_STATUS = 'N' 
		   AND F.FILE_LEVEL = 1
		   <if test='camping neq null and camping.equals("1")'>
		   AND B.BUSINESS_TYPE like '%' || #{camping} || '%'
		   </if>
		   <if test='glamping neq null and glamping.equals("2")'>
		   AND B.BUSINESS_TYPE like '%' || #{glamping} || '%'
		   </if>
		   <if test='caravan neq null and caravan.equals("3")'>
		   AND B.BUSINESS_TYPE like '%' || #{caravan} || '%'
		   </if>
		 GROUP BY C.CAMP_NO, C.CAMP_NAME, C.CAMP_ADDRESS, F.FILE_ROUTE, F.FILE_NEW_NAME 
		 ORDER BY C.CAMP_NAME DESC
	</select>



	<select id="campAllSearch" resultMap="searchAllCampMap">
		SELECT 
				C.CAMP_NO 
			  , C.CAMP_NAME 
			  , C.CAMP_ADDRESS 
			  , F.FILE_ROUTE 
			  , F.FILE_NEW_NAME 
			  , SUM(R.ROOM_COUNT) AS ROOM_COUNT 
			  , MAX(R.ROOM_MEMBER) AS MAX_GUEST 
			  , MIN(R.ROOM_PRICE) AS MIN_PRICE
			  , MAX(R.ROOM_PRICE) AS MAX_PRICE 
		   FROM ROOM R 
		   JOIN CAMP C ON R.CAMP_NO = C.CAMP_NO 
		   JOIN CAMP_FILE I ON C.CAMP_NO = I.CAMP_NO
		   JOIN "FILE" F ON I.FILE_NO = F.FILE_NO 
		  WHERE C.CAMP_STATUS = 'Y'
		    AND F.FILE_STATUS = 'N' 
		    AND F.FILE_LEVEL = 1 
		  GROUP BY C.CAMP_NO, C.CAMP_NAME, C.CAMP_ADDRESS, F.FILE_ROUTE, F.FILE_NEW_NAME 
		  ORDER BY C.CAMP_NAME DESC
	</select>
</mapper>