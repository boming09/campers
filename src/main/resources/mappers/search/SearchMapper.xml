<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cp.campers.search.model.dao.SearchMapper">

	<resultMap id="searchAllCampMap" type="com.cp.campers.search.model.vo.SearchCamp">
		<id property="cNo" column="CAMP_NO" />
		<result property="cName" column="CAMP_NAME"/>
		<result property="cAddress" column="CAMP_ADDRESS"/>
		<result property="rCount" column="ROOM_COUNT"/>
		<result property="revStatus" column="RESER_STATE"/>
		<result property="checkIn" column="CHECKIN"/>
		<result property="checkOut" column="CHECKOUT"/>
		<result property="maxGuest" column="MAX_GUEST"/>
		<result property="minPrice" column="MIN_PRICE"/>
		<result property="maxPrice" column="MAX_PRICE"/>
		<result property="fileRoute" column="FILE_ROUTE"/>
		<result property="fileName" column="FILE_NEW_NAME"/>
	</resultMap>



	<select id="mainSearch" parameterType="hashmap" resultType="com.cp.campers.search.model.vo.SearchCamp">
		SELECT
               C.CAMP_NO
			 , C.CAMP_NAME
			 , C.CAMP_ADDRESS
			 , R.ROOM_COUNT
			 , E.RESER_STATE
			 , E.CHECKIN
			 , E.CHECKOUT
             , MAX(R.ROOM_MEMBER) AS MAX_GUEST
             , MIN(R.ROOM_PRICE) AS MIN_PIRCE
             , MAX(R.ROOM_PRICE) AS MAX_PRICE
             , FILE_ROUTE
             , FILE_NEW_NAME
		  FROM CAMP C
		  JOIN CAMP_BUSINESS_TYPE T ON C.CAMP_NO = T.CAMP_NO
		  JOIN BUSINESS_TYPE B ON B.BUSINESS_NO = T.BUSINESS_NO
		  JOIN ROOM R ON C.CAMP_NO = R.CAMP_NO 
		  JOIN RESERVE E ON R.ROOM_NO = E.ROOM_NO
		  JOIN CAMP_FILE F ON C.CAMP_NO = F.CAMP_NO
		  JOIN "FILE" I ON F.FILE_NO = I.FILE_NO
		 WHERE C.CAMP_STATUS = 'Y'
		   AND C.CAMP_ADDRESS LIKE '%' ||  #{area} || '%'
		   AND R.ROOM_MEMBER &gt;= #{guest}
		   AND E.CHECKIN NOT IN #{checkIn}
		   AND E.CHECKOUT NOT IN #{checkOut}
		   AND I.FILE_STATUS = 'N'
		   AND I.FILE_LEVEL = 1
		<if test="camping.equals('1')">
		   AND B.BUSINESS_TYPE like '%' || #{camping} || '%'
		</if>
		<if test="glamping.equals('2')">
		   AND B.BUSINESS_TYPE like '%' || #{glamping} || '%'
		</if>
		<if test="caravan.equals('3')">
		   AND B.BUSINESS_TYPE like '%' || #{caravan} || '%'
		</if>
		 GROUP BY C.CAMP_NO
			 , C.CAMP_NAME
			 , C.CAMP_ADDRESS
			 , R.ROOM_COUNT
			 , E.RESER_STATE
			 , E.CHECKIN
			 , E.CHECKOUT
             , R.ROOM_MEMBER
             , R.ROOM_PRICE
             , R.ROOM_PRICE
             , FILE_ROUTE
             , FILE_NEW_NAME
	</select>
	
	
	
	<select id="campAllSearch" resultMap="searchAllCampMap">
		SELECT
               C.CAMP_NO
			 , C.CAMP_NAME
			 , C.CAMP_ADDRESS
			 , R.ROOM_COUNT
			 , E.RESER_STATE
			 , E.CHECKIN
			 , E.CHECKOUT
             , MAX(R.ROOM_MEMBER) AS MAX_GUEST
             , MIN(R.ROOM_PRICE) AS MIN_PIRCE
             , MAX(R.ROOM_PRICE) AS MAX_PRICE
             , FILE_ROUTE
             , FILE_NEW_NAME
		  FROM CAMP C
		  JOIN CAMP_BUSINESS_TYPE T ON C.CAMP_NO = T.CAMP_NO
		  JOIN BUSINESS_TYPE B ON B.BUSINESS_NO = T.BUSINESS_NO
		  JOIN ROOM R ON C.CAMP_NO = R.CAMP_NO 
		  JOIN RESERVE E ON R.ROOM_NO = E.ROOM_NO
		  JOIN CAMP_FILE F ON C.CAMP_NO = F.CAMP_NO
		  JOIN "FILE" I ON F.FILE_NO = I.FILE_NO
		 WHERE C.CAMP_STATUS = 'Y'
		   AND I.FILE_STATUS = 'N'
		   AND I.FILE_LEVEL = 1
		 GROUP BY C.CAMP_NO
			 , C.CAMP_NAME
			 , C.CAMP_ADDRESS
			 , R.ROOM_COUNT
			 , E.RESER_STATE
			 , E.CHECKIN
			 , E.CHECKOUT
             , R.ROOM_MEMBER
             , R.ROOM_PRICE
             , R.ROOM_PRICE
             , FILE_ROUTE
             , FILE_NEW_NAME
	</select>



</mapper>